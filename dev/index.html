<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · MixedTypesContainers.jl</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href><img src="assets/logo.png" alt="MixedTypesContainers.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href>MixedTypesContainers.jl</a></span></div><form class="docs-search" action="search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a><ul class="internal"><li><a class="tocitem" href="#Container-creation"><span>Container creation</span></a></li><li><a class="tocitem" href="#Container-iteration"><span>Container iteration</span></a></li></ul></li><li><a class="tocitem" href="design/">Design</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaSpaceMissionDesign/MixedTypesContainers.jl/blob/master/docs/src/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Containers.jl"><a class="docs-heading-anchor" href="#Containers.jl">Containers.jl</a><a id="Containers.jl-1"></a><a class="docs-heading-anchor-permalink" href="#Containers.jl" title="Permalink"></a></h1><p>Documentation for <a href="https://github.com/JuliaSpaceMissionDesign/Containers.jl">Containers.jl</a>.</p><h2 id="Container-creation"><a class="docs-heading-anchor" href="#Container-creation">Container creation</a><a id="Container-creation-1"></a><a class="docs-heading-anchor-permalink" href="#Container-creation" title="Permalink"></a></h2><p>All you need to know to create a new mixed-type container using <code>Containers.jl</code> is how to use the <code>@container</code> macro. The user have the possibility to create both <strong>named</strong> and <strong>unnamed</strong> fields within the user-defined container. In the latter case, a default name will be assigned during the container creation.</p><p>The basic syntax to be used to define a container is:</p><pre><code class="language-julia hljs">@container &quot;ContainerName&quot; begin
    &quot;field-1&quot; → T1,
    &quot;field-2&quot; → T2(1.0),
    T1(1.0),
    T2
end</code></pre><p>Here <code>ContainerName</code> is the user-defined name of the container. In the <code>begin ... end</code> block the container&#39;s field are instead listed. Four possible formats are available:</p><ul><li><code>&quot;field-1&quot; → T1</code> – field defined as type <code>T1</code> with name <code>field-1</code>;</li><li><code>&quot;field-1&quot; → T2(1.0)</code> – field defined as type <code>T2</code> with name <code>field-2</code>;</li><li><code>T1(1.0)</code> – unnamed filed with type <code>T1</code>;</li><li><code>T2</code> – unnamed filed with type <code>T2</code>;</li></ul><p>You can also use a type-only definition of the field or a type constructor. In the latter case, there is the possibility to create an empty constructor for the new container, where all the fields initialization is handled by the container constructor itself.</p><hr/><h2 id="Container-iteration"><a class="docs-heading-anchor" href="#Container-iteration">Container iteration</a><a id="Container-iteration-1"></a><a class="docs-heading-anchor-permalink" href="#Container-iteration" title="Permalink"></a></h2><p>The possibility to store mixed-types within a single container is end in itself if not comes along with an efficient way to iterate it. Therefore, <code>Containers.jl</code> containes a set of utility tools which are designed to allocation-freely iterate the user-defined containers.  To best introduce their use, let&#39;s consider and example where a user defined container  <code>Container</code> is created and a function <code>test_function</code> is defined as:</p><pre><code class="language-julia hljs">function test_function(c::Container)
    val = 0.0
    for i in eachindex(c)
        c[i].x = 1.0i
        val += iterate_function(c[i])
    end
    return val
end</code></pre><p>This function modify a (common) field of the container and apply <code>iterate_function</code> to  compute a <code>val</code> variable, which is returned as output. The main issue here is associated  to the fact that, being each element of the container of a different type, this function allocates. </p><h3 id="Function-barriers-method"><a class="docs-heading-anchor" href="#Function-barriers-method">Function barriers method</a><a id="Function-barriers-method-1"></a><a class="docs-heading-anchor-permalink" href="#Function-barriers-method" title="Permalink"></a></h3><p>One possible solution is to exploit <a href="https://docs.julialang.org/en/v1/manual/performance-tips/#kernel-functions">function barriers</a> to avoid it at the cost of a very <em>structured</em> and less portable/maintainable code. As additional drawback, poor performances of this  approach are observed. For comparison, consider a 2 elements container and a <code>iterate_function</code> that simply reads a value within a container element:</p><pre><code class="language-julia-repl hljs">julia&gt; @benchmark test_barrier($c)
BenchmarkTools.Trial: 10000 samples with 995 evaluations.
 Range (min … max):  27.461 ns …   2.720 μs  ┊ GC (min … max):  0.00% … 98.28%
 Time  (median):     29.851 ns               ┊ GC (median):     0.00%
 Time  (mean ± σ):   39.396 ns ± 144.435 ns  ┊ GC (mean ± σ):  21.35% ±  5.74%

   ▆▆█▃                                                         
  ▄████▇▅▅▆▄▃▃▃▃▂▂▂▂▂▂▂▂▂▂▂▂▂▁▂▁▂▂▂▂▂▁▁▂▂▂▂▂▂▂▂▂▂▂▁▂▂▂▂▂▂▂▂▂▁▂ ▃
  27.5 ns         Histogram: frequency by time         66.8 ns &lt;

 Memory estimate: 0 bytes, allocs estimate: 0.</code></pre><h3 id="Unwrapped-iteration-method"><a class="docs-heading-anchor" href="#Unwrapped-iteration-method">Unwrapped iteration method</a><a id="Unwrapped-iteration-method-1"></a><a class="docs-heading-anchor-permalink" href="#Unwrapped-iteration-method" title="Permalink"></a></h3><p>Within <code>Containers.jl</code> and alternative approach is adopted by means of the introduction of two macros: <code>@unwrap</code> and <code>@iterated</code>. These have two precise roles:</p><ul><li><code>@unwrap</code>: decorate <code>for</code> loops. It transforms the expression in a specialized,   non-allocating one. For example, with reference to the <code>test_function</code> the <code>for</code> loop    can be transformed to:</li></ul><pre><code class="language-julia hljs">@unwrap for i in eachindex(c)
    c[i].x = 1.0i
    val += iterate_function(c[i])
end</code></pre><ul><li><code>@iterated</code>: decorate a <code>function</code> that containes <code>Container</code>&#39;s iterations. It is used   to tranform the part of the function associated to the <code>Container</code>. For example, with   reference to the <code>test_function</code>:</li></ul><pre><code class="language-julia hljs">@iterated function test_iterated(c::ExampleContainer{N}) where {N}
    val = 0.0
    @unwrap for i in 1:N
        c[i].x = 1.0i
        val += iterate_function(c[i])
    end
    return val
end</code></pre><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>Note that the use of <code>@iterated</code> comes always with the one of <code>@unwrap</code> as the latter transforms the <code>for</code> loop while the former the function itself. Note also that some modifications have been done to the new function:</p><ul><li><p>The function signature is now parametric in <code>N</code>. Here <code>N</code> represent the dimension of the    container and is a parameter automatically associated to the <code>AbstractContainer</code>    subtypes during their generation.</p></li><li><p>The <code>for</code> loop is still <em>unwrapped</em> with <code>@unwrap</code> but the iteration is specified using   the parametric argument <code>N</code>.</p></li></ul><p>These last two modification <strong>shall</strong> be applied to exploit <code>@iterated</code> functionalities at the current version of <code>Containers.jl</code>. This may change in future.</p></div></div><p>With this approach, just with some simple adjustments to the code, a non-allocating, high-performance version of the function can be obtained resulting in (more than) a order of magnitude  speed-up:</p><pre><code class="language-julia-repl hljs">julia&gt; @benchmark test_iterated($c)
BenchmarkTools.Trial: 10000 samples with 1000 evaluations.
 Range (min … max):  1.496 ns … 3.989 ns  ┊ GC (min … max): 0.00% … 0.00%
 Time  (median):     1.508 ns             ┊ GC (median):    0.00%
 Time  (mean ± σ):   1.511 ns ± 0.042 ns  ┊ GC (mean ± σ):  0.00% ± 0.00%

      ▁▁▃▄▃ ▅▆▆██▇▇▅▂                                        
  ▂▃▄▆█████▁█████████▁█▅▄▃▂▂▂▁▁▂▂▁▁▁▁▂▂▂▁▂▂▂▂▃▂▂▂▁▃▃▃▃▃▃▃▃▂ ▄
  1.5 ns         Histogram: frequency by time       1.55 ns &lt;

 Memory estimate: 0 bytes, allocs estimate: 0.</code></pre></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="design/">Design »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Saturday 27 May 2023 18:57">Saturday 27 May 2023</span>. Using Julia version 1.9.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
